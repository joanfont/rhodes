python: &python
  image: joanfont/rhodes
  links:
    - db
  volumes:
    - ".:/code"

gunicorn:
  <<: *python
  ports:
    - "8080:8080"
  command: ["rhodes:app", "-b", "0.0.0.0:8080", "--log-file=-", "--log-level=debug", "--reload"]

db:
  image: mariadb:10.0
  environment:
    - "MYSQL_ROOT_PASSWORD=root"
    - "MYSQL_USER=rhodes"
    - "MYSQL_PASSWORD=rhodes"
    - "MYSQL_DATABASE=rhodes"
  expose:
    - 3306
  volumes:
    - "/opt/rhodes/mysql:/var/lib/mysql/data"

manage: &manage
  <<: *python
  entrypoint: ["python", "rhodes.py"]

devel:
  <<: *manage
  ports:
    - "8080:8080"
  command: "runserver"

alembic: &alembic
  <<: *python
  volumes:
    - "./application/lib/:/code"
    - ".:/app/"
  entrypoint: ["alembic"]

revision:
  <<: *alembic
  command: ["revision", "--autogenerate"]

